<%- include('../partials/user/header') %>

<!-- Include SweetAlert library (CDN) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="/" rel="nofollow">Home</a>
                <span></span> Shop
                <span></span> Your Orders
            </div>
        </div>
    </div>

    <section class="pt-150 pb-150">
        <div class="container">
            <div class="row">
                <aside class="col-md-3">
                    <div class="sidebar">
                        <h4>Account Settings</h4><br>
                        <ul class="list-unstyled">
                            <li><a href="/profile">Profile</a></li>
                            <li><a href="/orders">Orders</a></li>
                            <li><a href="/wishlist">Wishlist</a></li>
                            <li><a href="/address">Address</a></li>
                            <li><a href="/logout-user">Logout</a></li>
                        </ul>
                    </div>
                </aside>

                <div class="col-md-9">
                    <h4>Your Orders</h4><br>
                    <% if (orders && orders.length > 0) { %>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% orders.forEach(order => { %>
                                    <tr>
                                        <td>#<%= order.orderId %></td>
                                        <td><%= order.createdOn.toLocaleDateString() %></td>
                                        <td><%= order.status %></td>
                                        <td>â‚¹<%=order.finalAmount.toLocaleString() %></td>
                                        <td>
                                            <a href="/order-details?id=<%= order._id %>" class="btn btn-success">View Details</a>
                                            <% if (order.status !== 'Cancelled' && order.status !== 'Completed') { %>
                                                <button class="btn btn-danger" onclick="confirmCancelOrder('<%= order._id %>')">Cancel Order</button>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    <% } else { %>
                        <p>You have no orders yet.</p>
                    <% } %>
                </div>
            </div>
        </div>
    </section>
</main>

<%- include('../partials/user/footer') %>

<script>
    function confirmCancelOrder(orderId) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, cancel it!'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/cancel-order?id=' + orderId;
            }
        });
    }
</script>
